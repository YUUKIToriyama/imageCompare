(this.webpackJsonpimageCompare=this.webpackJsonpimageCompare||[]).push([[0],{120:function(e,t,n){},145:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n(0),i=n.n(r),s=n(14),c=n.n(s),o=(n(120),n(10)),l=n(11),d=n(13),p=n(12),h=n(104),u=n(176),j=n(189),b=n(83),m=n.n(b),O=n(42),v=n.n(O),g=n(183),f=n(184),x=n(165),C=n(36),y=n(101),S=n.n(y),k=n(33),w=n(84),I=n(191),R=n(167),N=n(168),L=n(169),P=n(192),B=n(170),A=n(172),D=n(166),E=n(171),_=n(173),z=n(174),M=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleDrawerOpen=function(){a.setState({open:!0})},a.handleDrawerClose=function(){a.setState({open:!1})},a.state={open:!1},a.handleDrawerClose.bind(Object(k.a)(a)),a.handleDrawerOpen.bind(Object(k.a)(a)),a}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props.classes;return Object(a.jsxs)(I.a,{className:e.drawer,variant:"persistent",anchor:"left",open:this.state.open,classes:{paper:e.drawerPaper},children:[Object(a.jsx)("div",{className:e.drawerHeader,children:Object(a.jsx)(x.a,{onClick:this.handleDrawerClose,children:Object(a.jsx)(D.a,{})})}),Object(a.jsx)(R.a,{}),Object(a.jsxs)(N.a,{children:[Object(a.jsx)(L.a,{href:"https://github.com/YUUKIToriyama/imageCompare",children:Object(a.jsxs)(P.a,{button:!0,children:[Object(a.jsx)(B.a,{children:Object(a.jsx)(E.a,{})}),Object(a.jsx)(A.a,{children:"View Source Code"})]},"Github")}),Object(a.jsxs)(P.a,{button:!0,children:[Object(a.jsx)(B.a,{children:Object(a.jsx)(_.a,{})}),Object(a.jsx)(A.a,{children:"More information"})]},"Information"),Object(a.jsxs)(P.a,{button:!0,children:[Object(a.jsx)(B.a,{children:Object(a.jsx)(z.a,{})}),Object(a.jsx)(A.a,{children:"Show Help"})]},"Help")]})]})}}]),n}(i.a.Component),T=v()((function(e){return{drawer:{width:240,flexShrink:0},drawerPaper:{width:240},drawerHeader:Object(w.a)(Object(w.a)({display:"flex",alignItems:"center",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-end"})}}))(M),U=n(177),F=n(178),V=n(179),H=n(180),K=n(181),q=n(182),Y=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleClickOpen=function(){a.setState({open:!0})},a.handleClose=function(){a.setState({open:!1})},a.state={open:!1},a.descriptionElement=i.a.createRef(),a}return Object(l.a)(n,[{key:"render",value:function(){return Object(a.jsxs)("div",{children:[Object(a.jsx)(U.a,{onClick:this.handleClickOpen,children:this.props.label}),Object(a.jsxs)(F.a,{open:this.state.open,onClose:this.handleClose,scroll:"paper","aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[Object(a.jsx)(V.a,{id:"scroll-dialog-title",children:this.props.title}),Object(a.jsx)(H.a,{dividers:!0,children:Object(a.jsx)(K.a,{id:"scroll-dialog-description",ref:this.descriptionElement,tabIndex:-1,children:this.props.content})}),Object(a.jsx)(q.a,{children:Object(a.jsx)(U.a,{onClick:this.handleClose,color:"primary",children:"OK"})})]})]})}}]),n}(i.a.Component),G=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).handleDrawerOpen=function(){a.drawerRef.current.handleDrawerOpen()},a.drawerRef=i.a.createRef(),a}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props.classes;return Object(a.jsxs)("div",{className:e.root,children:[Object(a.jsx)(g.a,{position:"static",children:Object(a.jsxs)(f.a,{children:[Object(a.jsx)(x.a,{edge:"start",className:e.menuButton,color:"inherit","aria-label":"menu",children:Object(a.jsx)(S.a,{onClick:this.handleDrawerOpen})}),Object(a.jsx)(C.a,{variant:"h6",className:e.title,children:this.props.title}),Object(a.jsx)(Y,{label:"Help",title:"About this app",content:this.props.message})]})}),Object(a.jsx)(T,{ref:this.drawerRef})]})}}]),n}(i.a.Component),J=v()((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}))(G),Q=n(193),W=n(194),X=n(186),Z=n(190),$=n(195),ee=n(105),te=n(185),ne=n(102),ae=n.n(ne),re=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).fileInputCallback=function(e){var t=e,n=new Image;n.src=t.base64,n.onload=function(){t.width=n.width,t.height=n.height,a.setState({file:t}),a.props.onInputImageChange(t)}},a.state={file:{}},a}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return Object(a.jsx)(Q.a,{children:Object(a.jsx)(ae.a,{labelText:this.props.loaderId+1+"\u679a\u76ee",imagePreview:!0,multiple:!1,callbackFunction:function(t){console.log(t.name),e.fileInputCallback(t,1)},buttonComponent:Object(a.jsx)(x.a,{color:"primary","aria-label":"upload picture",component:"span",children:Object(a.jsx)(te.a,{})}),textFieldComponent:Object(a.jsx)("input",{type:"text"}),accept:"image/*"})})}}]),n}(i.a.Component),ie=(n(97),n(27)),se=n.n(ie),ce=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).mapRef=i.a.createRef(),a.map=null,a.layer=null,a.imageBounds,a.markers=[],a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.image;this.imageBounds=new se.a.latLngBounds([[-t.height/2,-t.width/2],[t.height/2,t.width/2]]),this.map=se.a.map(this.mapRef.current,{center:[0,0],maxBounds:this.imageBounds.pad(.3),crs:se.a.CRS.Simple}),this.layer=se.a.imageOverlay(t.base64,this.imageBounds),this.layer.addTo(this.map),this.map.fitBounds(this.imageBounds);for(var n=0;n<this.props.n_marker;n++){var a=se.a.divIcon({html:'<div class="bg-round"><span>'.concat(this.props.n_marker-n,"</span></div>"),className:"divicon"}),r=this.map.getCenter(),i=new se.a.marker(r,{draggable:!0,icon:a});this.markers.push(i)}var s=function(){var t=e.markers.map((function(t){var n=t.getLatLng();return{x:e.props.image.width/2+n.lng,y:e.props.image.height/2-n.lat}}));e.props.onPointsSet(t,e.props.imageId)};s(),this.markers.forEach((function(t){t.on("moveend",(function(e){s()})),t.addTo(e.map)}))}},{key:"render",value:function(){return Object(a.jsx)("div",{ref:this.mapRef,style:{width:"100%",height:"300px"}})}}]),n}(i.a.Component),oe=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).images=a.props.images,a.state={correspondingPointsArray:[]},a.setCorrespondingPoints=a.setCorrespondingPoints.bind(Object(k.a)(a)),a.invisibleCanvasRef=i.a.createRef(),a.n_marker=4,a}return Object(l.a)(n,[{key:"executeImageMatching",value:function(){var e=this.state.correspondingPointsArray[0].map((function(e){return[e.x,e.y,1]})).flat(),t=this.state.correspondingPointsArray[1].map((function(e){return[e.x,e.y,1]})).flat(),n=function(e){var t=new Image;t.src=e,t.id="test",t.onload=function(){return t}},a=function(e,t,n,a,r){var i=(l=cv.matFromArray(r,3,cv.CV_32F,n),d=cv.matFromArray(r,3,cv.CV_32F,a),p=0,new cv.Mat(3,3,cv.CV_32F),cv.findHomography(l,d,p)),s=cv.imread(e,cv.IMREAD_COLOR),c=cv.imread(t,cv.IMREAD_COLOR),o=cv.Mat.zeros(c.rows,c.cols,cv.CV_8UC3);var l,d,p;return cv.warpPerspective(s,o,i,new cv.Size(o.cols,o.rows),cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar),s.delete(),c.delete(),o}(n(this.images[0].base64).id,n(this.images[1].base64),e,t,this.n_marker);cv.imshow(this.invisibleCanvasRef,a);var r=this.invisibleCanvasRef.toDataURL("image/png",1);this.props.onImageProcessingDone(r),a.delete()}},{key:"setCorrespondingPoints",value:function(e,t){var n=this.state.correspondingPointsArray;n[t]=e,this.setState({correspondingPointsArray:n})}},{key:"render",value:function(){return Object(a.jsxs)(Q.a,{children:[Object(a.jsx)(ce,{imageId:0,image:this.images[0],onPointsSet:this.setCorrespondingPoints,n_marker:this.n_marker}),Object(a.jsx)(ce,{imageId:1,image:this.images[1],onPointsSet:this.setCorrespondingPoints,n_marker:this.n_marker}),Object(a.jsx)("canvas",{ref:this.invisibleCanvasRef,style:{display:"none"}})]})}}]),n}(i.a.Component),le=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={lat:0,lng:0,zoom:0,crs:se.a.CRS.Simple},a}return Object(l.a)(n,[{key:"render",value:function(){this.props.image;return Object(a.jsx)("div",{})}}]),n}(i.a.Component),de=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).steps=["\u753b\u50cf\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9","\u5bfe\u5fdc\u70b9\u3092\u9078\u629e","\u5909\u63db"],r.renderImageLoader=function(e){return Object(a.jsx)(re,{loaderId:e,onInputImageChange:function(t){var n=r.state.inputImages;n[e]=t,r.setState({inputImages:n})}})},r.executeImageMatching=function(){r.imageCropRef.current.executeImageMatching()},r.handleImageProcessingDone=function(e){r.setState({processedImage:e})},r.handleNext=function(){r.setState({activeStep:r.state.activeStep+1})},r.handleBack=function(){r.setState({activeStep:r.state.activeStep-1})},r.handleReset=function(){r.setState({activeStep:0})},r.allowNextStep=function(){r.setState({goNextStep:!0})},r.getStepContent=function(e){switch(e){case 0:return Object(a.jsxs)(Q.a,{children:[Object(a.jsx)(C.a,{children:"\u51e6\u7406\u3092\u884c\u306a\u3046\u753b\u50cf\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"}),r.renderImageLoader(0),r.renderImageLoader(1)]});case 1:return Object(a.jsxs)(Q.a,{children:[Object(a.jsx)(C.a,{children:"\u30de\u30fc\u30ab\u30fc\u3092\u52d5\u304b\u3057\u3066\u5bfe\u5fdc\u3059\u308b\u70b9\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044"}),Object(a.jsx)(oe,{ref:r.imageCropRef,images:r.state.inputImages,onImageProcessingDone:r.handleImageProcessingDone}),Object(a.jsx)(U.a,{onClick:r.executeImageMatching,children:"\u958b\u59cb"})]});case 2:return Object(a.jsxs)(Q.a,{children:[Object(a.jsx)(C.a,{children:"\u51e6\u7406\u4e2d\u2026\u2026"}),Object(a.jsx)(le,{image:r.state.processedImage})]});default:return Object(a.jsx)(C.a,{children:"Unknown step"})}},r.state={activeStep:0,goNextStep:!0,inputImages:[null,null],processedImage:""},r.imageCropRef=i.a.createRef(),r}return Object(l.a)(n,[{key:"render",value:function(){var e=this;return Object(a.jsxs)(Q.a,{className:this.props.classes.root,children:[Object(a.jsx)(W.a,{activeStep:this.state.activeStep,orientation:"vertical",children:this.steps.map((function(t,n){return Object(a.jsxs)(X.a,{children:[Object(a.jsx)(Z.a,{children:t}),Object(a.jsxs)($.a,{children:[e.getStepContent(n),Object(a.jsx)(Q.a,{className:e.props.classes.actionsContainer,children:Object(a.jsxs)(Q.a,{children:[Object(a.jsx)(U.a,{disabled:0===e.state.activeStep,onClick:e.handleBack,className:e.props.classes.button,children:"Back"}),Object(a.jsx)(U.a,{disabled:!e.state.goNextStep,variant:"contained",color:"primary",onClick:e.handleNext,className:e.props.classes.button,children:e.state.activeStep===e.steps.length-1?"Finish":"Next"})]})})]})]},t)}))}),this.state.activeStep===this.steps.length&&Object(a.jsxs)(ee.a,{square:!0,elevation:0,className:this.props.classes.resetContainer,children:[Object(a.jsx)(C.a,{children:"\u51e6\u7406\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\uff01"}),Object(a.jsx)(U.a,{onClick:this.handleReset,className:this.props.classes.button,children:"\u3084\u308a\u76f4\u3059"})]})]})}}]),n}(i.a.Component),pe=v()({root:{width:"100%"},button:{marginTop:"15px",marginRight:"15px"},actionsContainer:{marginBottom:"15px"},resetContainer:{padding:"15px"}})(de),he=function(){function e(){Object(o.a)(this,e)}return Object(l.a)(e,[{key:"loadOpenCV",value:function(e,t){var n=document.createElement("script");n.setAttribute("async",""),n.setAttribute("type","text/javascript"),n.addEventListener("load",(function(){cv.getBuildInformation?(console.log(cv.getBuildInformation()),t()):cv.onRuntimeInitialized=function(){console.log(cv.getBuildInformation()),t()}})),n.addEventListener("error",(function(){console.error("Failed to load "+e)})),n.src=e,document.querySelector("head").appendChild(n)}},{key:"loadImage",value:function(e,t){var n=new Image;n.crossOrigin="anonymous",n.src=e,n.onload=function(){var e=cv.imread(n,cv.IMREAD_COLOR);t(e),e.delete()}}},{key:"executeScript",value:function(e){var t=e,n=document.createElement("script");n.setAttribute("type","text/javascript"),n.src=t,n.addEventListener("load",(function(){console.log("Now loading "+t)})),n.addEventListener("onload",(function(){console.log("Executing "+t)})),document.querySelector("body").appendChild(n)}}],[{key:"credit",value:function(){console.log("(C) Copyright 2020 YUUKIToriyama, All Rights Reserved.")}}]),e}(),ue=n(7),je=n.n(ue),be=n(187),me=n(188),Oe=n(103),ve=n.n(Oe),ge=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(a.jsxs)(Q.a,{children:[this.props.opencvLoaded?Object(a.jsx)(me.a,{color:"primary",fontSize:"large",children:Object(a.jsx)(ve.a,{})}):Object(a.jsx)(be.a,{}),Object(a.jsx)(C.a,{children:this.props.opencvLoaded?"OpenCV.js has been loaded on your browser!":"Now Loading OpenCV.js..."}),this.props.opencvLoaded?Object(a.jsx)(Y,{label:"About OpenCV.js",title:"Build information",content:cv.getBuildInformation().split("\n").map((function(e){return Object(a.jsxs)("span",{children:[e,Object(a.jsx)("br",{})]})}))}):""]})}}]),n}(i.a.Component),fe=ge;ge.propsTypes={opencvLoaded:je.a.bool.isRequired},ge.defaultProps={opencvLoaded:!1};var xe=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={opencvLoaded:!1},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){var e=this;(new he).loadOpenCV("https://docs.opencv.org/4.5.0/opencv.js",(function(){e.setState({opencvLoaded:!0})}))}},{key:"render",value:function(){return Object(a.jsxs)("div",{children:[Object(a.jsx)(fe,{opencvLoaded:this.state.opencvLoaded}),Object(a.jsx)(pe,{})]})}}]),n}(i.a.Component),Ce=Object(h.a)({palette:{primary:m.a},typography:{fontFamily:["Roboto","Noto Sans"].join(","),fontSize:13,h1:{fontSize:"1.75rem"},h2:{fontSize:"1.5rem"},h3:{fontSize:"1.25rem"},h4:{fontSize:"1.125rem"},h5:{fontSize:"1rem"},h6:{fontSize:"1rem"}}}),ye=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){return Object(o.a)(this,n),t.call(this,e)}return Object(l.a)(n,[{key:"render",value:function(){return Object(a.jsxs)(u.a,{theme:Ce,children:[Object(a.jsx)(j.a,{}),Object(a.jsx)(J,{title:"imageCompare",message:"\nimageCompare 0.9\nhttps://github.com/YUUKIToriyama/imageCompare\n(C)Copyright 2020 YUUKIToriyama All Rights Reserved.\n"}),Object(a.jsx)(xe,{})]})}}]),n}(i.a.Component);c.a.render(Object(a.jsx)(ye,{}),document.getElementById("app"))}},[[145,1,2]]]);
//# sourceMappingURL=main.1b44e186.chunk.js.map