(this.webpackJsonpimageCompare=this.webpackJsonpimageCompare||[]).push([[0],{121:function(e,t,a){},149:function(e,t,a){"use strict";a.r(t);var n=a(2),r=a(0),i=a.n(r),s=a(14),c=a.n(s),o=(a(121),a(10)),l=a(11),h=a(13),d=a(12),p=a(105),u=a(185),j=a(199),b=a(83),m=a.n(b),v=a(43),f=a.n(v),O=a(192),g=a(193),x=a(174),y=a(34),w=a(102),C=a.n(w),k=a(28),S=a(84),I=a(201),R=a(176),L=a(177),N=a(178),B=a(203),P=a(179),E=a(181),A=a(175),T=a(180),D=a(182),M=a(183),V=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleDrawerOpen=function(){n.setState({open:!0})},n.handleDrawerClose=function(){n.setState({open:!1})},n.state={open:!1},n.handleDrawerClose.bind(Object(k.a)(n)),n.handleDrawerOpen.bind(Object(k.a)(n)),n}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props.classes;return Object(n.jsxs)(I.a,{className:e.drawer,variant:"persistent",anchor:"left",open:this.state.open,classes:{paper:e.drawerPaper},children:[Object(n.jsx)("div",{className:e.drawerHeader,children:Object(n.jsx)(x.a,{onClick:this.handleDrawerClose,children:Object(n.jsx)(A.a,{})})}),Object(n.jsx)(R.a,{}),Object(n.jsxs)(L.a,{children:[Object(n.jsx)(N.a,{href:"https://github.com/YUUKIToriyama/imageCompare",children:Object(n.jsxs)(B.a,{button:!0,children:[Object(n.jsx)(P.a,{children:Object(n.jsx)(T.a,{})}),Object(n.jsx)(E.a,{children:"View Source Code"})]},"Github")}),Object(n.jsxs)(B.a,{button:!0,children:[Object(n.jsx)(P.a,{children:Object(n.jsx)(D.a,{})}),Object(n.jsx)(E.a,{children:"More information"})]},"Information"),Object(n.jsxs)(B.a,{button:!0,children:[Object(n.jsx)(P.a,{children:Object(n.jsx)(M.a,{})}),Object(n.jsx)(E.a,{children:"Show Help"})]},"Help")]})]})}}]),a}(i.a.Component),_=f()((function(e){return{drawer:{width:240,flexShrink:0},drawerPaper:{width:240},drawerHeader:Object(S.a)(Object(S.a)({display:"flex",alignItems:"center",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-end"})}}))(V),z=a(186),F=a(187),U=a(188),Y=a(189),H=a(190),K=a(191),q=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleClickOpen=function(){n.setState({open:!0})},n.handleClose=function(){n.setState({open:!1})},n.state={open:!1},n.descriptionElement=i.a.createRef(),n}return Object(l.a)(a,[{key:"render",value:function(){return Object(n.jsxs)("div",{children:[Object(n.jsx)(z.a,{onClick:this.handleClickOpen,children:this.props.label}),Object(n.jsxs)(F.a,{open:this.state.open,onClose:this.handleClose,scroll:"paper","aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[Object(n.jsx)(U.a,{id:"scroll-dialog-title",children:this.props.title}),Object(n.jsx)(Y.a,{dividers:!0,children:Object(n.jsx)(H.a,{id:"scroll-dialog-description",ref:this.descriptionElement,tabIndex:-1,children:this.props.content})}),Object(n.jsx)(K.a,{children:Object(n.jsx)(z.a,{onClick:this.handleClose,color:"primary",children:"OK"})})]})]})}}]),a}(i.a.Component),G=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleDrawerOpen=function(){n.drawerRef.current.handleDrawerOpen()},n.drawerRef=i.a.createRef(),n}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props.classes;return Object(n.jsxs)("div",{className:e.root,children:[Object(n.jsx)(O.a,{position:"static",children:Object(n.jsxs)(g.a,{children:[Object(n.jsx)(x.a,{edge:"start",className:e.menuButton,color:"inherit","aria-label":"menu",onClick:this.handleDrawerOpen,children:Object(n.jsx)(C.a,{})}),Object(n.jsx)(y.a,{variant:"h6",className:e.title,children:this.props.title}),Object(n.jsx)(q,{label:"Help",title:"About this app",content:this.props.message})]})}),Object(n.jsx)(_,{ref:this.drawerRef})]})}}]),a}(i.a.Component),J=f()((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}}))(G),Q=a(204),W=a(205),X=a(206),Z=a(197),$=a(200),ee=a(106),te=a(196),ae=a(194),ne=a(103),re=a.n(ne),ie=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).fileInputCallback=function(t){var a=t,n=new Image;n.src=a.base64,n.onload=function(){a.width=n.width,a.height=n.height,e.props.onInputImageChange(a)}},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return Object(n.jsx)(Q.a,{children:Object(n.jsx)(re.a,{labelText:this.props.loaderId+1+"\u679a\u76ee",imagePreview:!0,multiple:!1,callbackFunction:function(t){console.log(t.name+" has been loaded."),e.fileInputCallback(t)},buttonComponent:Object(n.jsx)(x.a,{color:"primary","aria-label":"upload picture",component:"span",children:Object(n.jsx)(ae.a,{})}),textFieldComponent:Object(n.jsx)("input",{type:"text"}),accept:"image/*"})})}}]),a}(i.a.Component),se=(a(98),a(17)),ce=a.n(se),oe=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).mapRef=i.a.createRef(),n.map=null,n.layer=null,n.imageBounds,n.markers=[],n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props.image;this.imageBounds=new ce.a.latLngBounds([[-t.height/2,-t.width/2],[t.height/2,t.width/2]]),this.map=ce.a.map(this.mapRef.current,{center:[0,0],maxBounds:this.imageBounds.pad(.3),crs:ce.a.CRS.Simple}),this.layer=ce.a.imageOverlay(t.base64,this.imageBounds),this.layer.addTo(this.map),this.map.fitBounds(this.imageBounds);for(var a=0;a<this.props.n_marker;a++){var n=ce.a.divIcon({html:'<div class="bg-round"><span>'.concat(this.props.n_marker-a,"</span></div>"),className:"divicon"}),r=this.map.getCenter(),i=r.lat,s=r.lng;i+=50*Math.cos(2*(a+1)*Math.PI/this.props.n_marker),s+=50*Math.sin(2*(a+1)*Math.PI/this.props.n_marker);var c=new ce.a.marker([i,s],{draggable:!0,icon:n});this.markers.push(c)}var o=function(){var t=e.markers.map((function(t){var a=t.getLatLng();return{x:e.props.image.width/2+a.lng,y:e.props.image.height/2-a.lat}}));e.props.onPointsSet(t,e.props.imageId)};o(),this.markers.forEach((function(t){t.on("moveend",(function(e){o()})),t.addTo(e.map)}))}},{key:"render",value:function(){return Object(n.jsx)("div",{ref:this.mapRef,style:{width:"100%",height:"300px"}})}}]),a}(i.a.Component),le=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).images=n.props.images,n.state={correspondingPointsArray:[null,null]},n.setCorrespondingPoints=n.setCorrespondingPoints.bind(Object(k.a)(n)),n.invisibleCanvasRef=i.a.createRef(),n.n_marker=4,n}return Object(l.a)(a,[{key:"setCorrespondingPoints",value:function(e,t){var a=this.state.correspondingPointsArray;a[t]=e,this.setState({correspondingPointsArray:a})}},{key:"executeImageMatching",value:function(){var e,t,a=this.state.correspondingPointsArray[0].map((function(e){return[e.x,e.y,1]})).flat(),n=this.state.correspondingPointsArray[1].map((function(e){return[e.x,e.y,1]})).flat(),r=function(e){var t=new Image;return t.src=e,t},i=function(e,t,a,n,r){var i=(c=cv.matFromArray(r,3,cv.CV_32F,a),o=cv.matFromArray(r,3,cv.CV_32F,n),l=0,new cv.Mat(3,3,cv.CV_32F),cv.findHomography(c,o,l)),s=cv.Mat.zeros(t.rows,t.cols,cv.CV_8UC3);var c,o,l;return cv.warpPerspective(e,s,i,new cv.Size(s.cols,s.rows),cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar),s}(e=cv.imread(r(this.images[0].base64)),t=cv.imread(r(this.images[1].base64)),a,n,this.n_marker);cv.imshow(this.invisibleCanvasRef.current,i);var s=this.invisibleCanvasRef.current.toDataURL("image/png",1),c={name:this.images[0].name+"(Transformed)",base64:s,width:this.invisibleCanvasRef.current.width,height:this.invisibleCanvasRef.current.height};this.props.onImageProcessingDone(c),e.delete(),t.delete(),i.delete()}},{key:"render",value:function(){return Object(n.jsxs)(Q.a,{children:[Object(n.jsx)(oe,{imageId:0,image:this.images[0],onPointsSet:this.setCorrespondingPoints,n_marker:this.n_marker}),Object(n.jsx)(oe,{imageId:1,image:this.images[1],onPointsSet:this.setCorrespondingPoints,n_marker:this.n_marker}),Object(n.jsx)("canvas",{ref:this.invisibleCanvasRef,style:{display:"none"}})]})}}]),a}(i.a.Component),he=a(202),de=a(195),pe=(a(146),a(147),a(148),function(e){var t=e.name,a=e.width,n=e.height;return{fileName:t,imageLayer:ce.a.imageOverlay(e.base64,[[-1*n/2,-1*a/2],[n/2,a/2]])}}),ue=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).viewer,n.layers={},n.viewerRef=i.a.createRef(),n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.viewer=ce.a.map(this.viewerRef.current,{center:[0,0],crs:ce.a.CRS.Simple,zoom:0}),this.props.images.forEach((function(t){var a=pe(t),n=a.fileName,r=a.imageLayer;e.layers[n]=r})),Object.keys(this.layers).forEach((function(t){e.viewer.addLayer(e.layers[t])})),ce.a.control.layers({},this.layers,{collapsed:!1}).addTo(this.viewer),ce.a.control.opacity(this.layers,{label:"\u900f\u660e\u5ea6\u3092\u5909\u66f4",collapsed:!1}).addTo(this.viewer)}},{key:"render",value:function(){return Object(n.jsx)("div",{ref:this.viewerRef,style:{width:"100%",height:"500px"}})}}]),a}(i.a.Component),je=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).viewer1,n.viewer2,n.viewer1Ref=i.a.createRef(),n.viewer2Ref=i.a.createRef(),n.imageLayers=[],n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.props.images.forEach((function(t,a){var n=pe(t),r=n.fileName,i=n.imageLayer,s={};s[r]=i,e.imageLayers.push(s)})),this.viewer1=ce.a.map(this.viewer1Ref.current,{center:[0,0],zoom:0,crs:ce.a.CRS.Simple}),ce.a.control.layers({},this.imageLayers[0],{collapsed:!1}).addTo(this.viewer1),this.viewer1.addLayer(Object.values(this.imageLayers[0])[0]),this.viewer2=ce.a.map(this.viewer2Ref.current,{center:[0,0],zoom:0,crs:ce.a.CRS.Simple}),ce.a.control.layers({},this.imageLayers[1],{collapsed:!1}).addTo(this.viewer2),this.viewer2.addLayer(Object.values(this.imageLayers[1])[0]),this.viewer1.sync(this.viewer2),this.viewer2.sync(this.viewer1)}},{key:"render",value:function(){return Object(n.jsxs)("div",{children:[Object(n.jsx)("div",{ref:this.viewer1Ref,style:{width:"50%",height:"500px",float:"left"}}),Object(n.jsx)("div",{ref:this.viewer2Ref,style:{width:"50%",height:"500px"}})]})}}]),a}(i.a.Component),be=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).OVERLAY=!0,n.MULTIPLE=!1,n.state={view:n.OVERLAY,toggleLabel:"\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u8868\u793a"},n.changeView=n.changeView.bind(Object(k.a)(n)),n}return Object(l.a)(a,[{key:"changeView",value:function(){this.setState((function(e){return{view:!e.view,toggleLabel:1==e.view?"\u4e8c\u753b\u9762\u8868\u793a":"\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u8868\u793a"}}))}},{key:"render",value:function(){return Object(n.jsxs)("div",{children:[Object(n.jsx)(de.a,{control:Object(n.jsx)(he.a,{checked:this.state.view,onChange:this.changeView}),label:this.state.toggleLabel}),this.state.view===this.OVERLAY&&Object(n.jsx)(ue,{images:this.props.images}),this.state.view===this.MULTIPLE&&Object(n.jsx)(je,{images:this.props.images})]})}}]),a}(i.a.Component),me=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return Object(n.jsxs)(Q.a,{children:[Object(n.jsx)(z.a,{disabled:0===this.props.activeStep,onClick:this.props.handleBack,children:"\u623b\u308b"}),Object(n.jsx)(z.a,{disabled:!this.props.isAllowedToStepForward,variant:"contained",color:"primary",onClick:this.props.handleNext,children:this.props.activeStep===this.props.steps.length-1?"\u7d42\u4e86":"\u9032\u3080"})]})}}]),a}(i.a.Component),ve=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).renderImageLoader=function(e){return Object(n.jsx)(ie,{loaderId:e,onInputImageChange:function(t){var a=r.state.inputImages;a[e]=t,r.setState({inputImages:a})}})},r.executeImageMatching=function(){r.imageCropRef.current.executeImageMatching()},r.handleImageProcessingDone=function(e){r.setState({transformedImage:e,processing:!1})},r.handleNext=function(){r.setState((function(e){return{activeStep:e.activeStep+1}}))},r.handleBack=function(){r.setState((function(e){return{activeStep:e.activeStep-1}}))},r.handleReset=function(){r.setState({activeStep:0})},r.getEachSteps=function(e){switch(e){case 0:return Object(n.jsxs)(W.a,{children:[Object(n.jsxs)(Q.a,{children:[Object(n.jsx)(y.a,{children:"\u51e6\u7406\u3092\u884c\u306a\u3046\u753b\u50cf\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"}),Object(n.jsxs)("div",{children:[r.renderImageLoader(0),r.renderImageLoader(1)]})]}),Object(n.jsx)(me,{activeStep:r.state.activeStep,handleBack:r.handleBack,handleNext:r.handleNext,isAllowedToStepForward:2==r.state.inputImages.length&&r.state.inputImages.every((function(e){return null!=e})),steps:r.steps})]});case 1:return Object(n.jsxs)(W.a,{children:[Object(n.jsxs)(Q.a,{children:[Object(n.jsx)(y.a,{children:"\u30de\u30fc\u30ab\u30fc\u3092\u52d5\u304b\u3057\u3066\u4e8c\u3064\u306e\u753b\u50cf\u306e\u9593\u3067\u5bfe\u5fdc\u3059\u308b\u70b9\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30de\u30fc\u30ab\u30fc\u3092\u52d5\u304b\u3057\u7d42\u308f\u3063\u305f\u3089\u51e6\u7406\u5b9f\u884c\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}),Object(n.jsx)(z.a,{variant:"contained",color:"secondary",onClick:function(){r.setState({processing:!0}),r.executeImageMatching()},children:"\u51e6\u7406\u5b9f\u884c"}),Object(n.jsx)(le,{ref:r.imageCropRef,images:r.state.inputImages,onImageProcessingDone:r.handleImageProcessingDone}),1==r.state.processing&&Object(n.jsx)(te.a,{})]}),Object(n.jsx)(me,{activeStep:r.state.activeStep,handleBack:r.handleBack,handleNext:r.handleNext,isAllowedToStepForward:void 0!=r.state.transformedImage.base64,steps:r.steps})]});case 2:return Object(n.jsxs)(W.a,{children:[Object(n.jsxs)(Q.a,{children:[Object(n.jsx)(y.a,{children:"\u51e6\u7406\u7d50\u679c"}),null!=r.state.inputImages[1]&&Object(n.jsx)(be,{images:[r.state.transformedImage,r.state.inputImages[1]]})]}),Object(n.jsx)(me,{activeStep:r.state.activeStep,handleBack:r.handleBack,handleNext:r.handleNext,isAllowedToStepForward:!0,steps:r.steps})]});default:return Object(n.jsx)(W.a,{children:Object(n.jsx)(y.a,{children:"Unknown step"})})}},r.state={activeStep:0,inputImages:[null,null],transformedImage:{},processing:!1},r.imageCropRef=i.a.createRef(),r.steps=["\u753b\u50cf\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9","\u5bfe\u5fdc\u70b9\u3092\u9078\u629e","\u753b\u50cf\u6bd4\u8f03\u30d3\u30e5\u30fc"],r}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return Object(n.jsxs)(Q.a,{className:this.props.classes.root,children:[Object(n.jsx)(X.a,{activeStep:this.state.activeStep,orientation:"vertical",children:this.steps.map((function(t,a){return Object(n.jsxs)(Z.a,{children:[Object(n.jsx)($.a,{children:t}),e.getEachSteps(a)]},t)}))}),this.state.activeStep===this.steps.length&&Object(n.jsxs)(ee.a,{square:!0,elevation:0,className:this.props.classes.resetContainer,children:[Object(n.jsx)(y.a,{children:"\u51e6\u7406\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f"}),Object(n.jsx)(z.a,{onClick:this.handleReset,className:this.props.classes.button,children:"\u6700\u521d\u306b\u623b\u308b"})]})]})}}]),a}(i.a.Component),fe=f()({root:{width:"100%"},button:{marginTop:"15px",marginRight:"15px"},actionsContainer:{marginBottom:"15px"},resetContainer:{padding:"15px"}})(ve),Oe=function(){function e(){Object(o.a)(this,e)}return Object(l.a)(e,[{key:"loadOpenCV",value:function(e,t){var a=document.createElement("script");a.setAttribute("type","text/javascript"),a.addEventListener("load",(function(){cv.getBuildInformation?(console.log(cv.getBuildInformation()),t()):cv.onRuntimeInitialized=function(){console.log(cv.getBuildInformation()),t()}})),a.addEventListener("error",(function(){console.error("Failed to load "+e)})),a.src=e,document.querySelector("head").appendChild(a)}},{key:"executeScript",value:function(e){var t=e,a=document.createElement("script");a.setAttribute("type","text/javascript"),a.src=t,a.addEventListener("load",(function(){console.log("Now loading "+t)})),a.addEventListener("onload",(function(){console.log("Executing "+t)})),document.querySelector("body").appendChild(a)}}],[{key:"loadImage",value:function(e){var t=new Image;return t.src=e,t}},{key:"credit",value:function(){console.log("(C) Copyright 2020 YUUKIToriyama, All Rights Reserved.")}}]),e}(),ge=a(7),xe=a.n(ge),ye=a(198),we=a(104),Ce=a.n(we),ke=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return Object(n.jsxs)(Q.a,{children:[this.props.opencvLoaded?Object(n.jsx)(ye.a,{color:"primary",fontSize:"large",children:Object(n.jsx)(Ce.a,{})}):Object(n.jsx)(te.a,{}),Object(n.jsx)(y.a,{children:this.props.opencvLoaded?"OpenCV.js has been loaded on your browser!":"Now Loading OpenCV.js..."}),1==this.props.opencvLoaded&&Object(n.jsx)(q,{label:"About OpenCV.js",title:"Build information",content:cv.getBuildInformation().split("\n").map((function(e,t){return Object(n.jsxs)("span",{children:[e,Object(n.jsx)("br",{})]},t)}))})]})}}]),a}(i.a.Component),Se=ke;ke.propsTypes={opencvLoaded:xe.a.bool.isRequired},ke.defaultProps={opencvLoaded:!1};var Ie=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={opencvLoaded:!1},n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=this;(new Oe).loadOpenCV("https://docs.opencv.org/4.5.0/opencv.js",(function(){e.setState({opencvLoaded:!0})}))}},{key:"render",value:function(){return Object(n.jsxs)("div",{children:[Object(n.jsx)(Se,{opencvLoaded:this.state.opencvLoaded}),Object(n.jsx)(fe,{})]})}}]),a}(i.a.Component),Re=Object(p.a)({palette:{primary:m.a},typography:{fontFamily:["Roboto","Noto Sans"].join(","),fontSize:13,h1:{fontSize:"1.75rem"},h2:{fontSize:"1.5rem"},h3:{fontSize:"1.25rem"},h4:{fontSize:"1.125rem"},h5:{fontSize:"1rem"},h6:{fontSize:"1rem"}}}),Le=function(e){Object(h.a)(a,e);var t=Object(d.a)(a);function a(e){return Object(o.a)(this,a),t.call(this,e)}return Object(l.a)(a,[{key:"render",value:function(){return Object(n.jsxs)(u.a,{theme:Re,children:[Object(n.jsx)(j.a,{}),Object(n.jsx)(J,{title:"imageCompare",message:"\nimageCompare 0.9\nhttps://github.com/YUUKIToriyama/imageCompare\n(C)Copyright 2020 YUUKIToriyama All Rights Reserved.\n"}),Object(n.jsx)(Ie,{})]})}}]),a}(i.a.Component);c.a.render(Object(n.jsx)(Le,{}),document.getElementById("app"))}},[[149,1,2]]]);
//# sourceMappingURL=main.de03171d.chunk.js.map